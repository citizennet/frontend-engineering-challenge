<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
		<TITLE>
			Interview Exercise | CitizenNet
		</title>
	</head>
		<script type="text/javascript" src="http://connect.facebook.net/en_US/all.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="http://yui.yahooapis.com/3.18.1/build/yui/yui-min.js"></script>
		<script type="text/javascript">
		
		function validate(){		
			
			if(window.XMLHttpRequest){
				req= new XMLHttpRequest();
			} else {
				if(window.ActiveXObject)
					req=new ActiveXObject("Microsoft.XMLHTTP");
			}

			if(req){
				req.onreadystatechange = callback;
				req.open("GET","http://rack1.citizennet.com/interviewtest/api?file=posts.json&access_token=AAAAAL2uajO8BAPcqOwZB6",true);
				//req.open("GET","http://rack1.citizennet.com/interviewtest/api?file=likes.json&access_token=AAAAAL2uajO8BAPcqOwZB6",true);
				req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=utf-8");
				req.send("");
			} else {
				alert("Sorry, but I could not create an XMLHttpRequest");
			}
		}

		function callback(){
			var dataJSON;
			if (req.readyState == 4 && req.status==200){
				//alert("Response: "+req.responseText);
					//document.write(req.responseText);
				dataJSON = eval('(' + req.responseText + ')');
				
			} else {
				//alert("fail");
			}
			var displayTable = '<table width = "100%" border = "1" style = "border-collapse: separate;">';
			if(!dataJSON.data[0].error){
				for(var j = 0; j < dataJSON.data.length; j++){
					//alert(dataJSON.data[j].id);
					//alert(dataJSON.data.length);
					userId = dataJSON.data[j].id;
					displayTable += '<tr><th colspan = "2"><div style = "float:left">Sr. No.: ' + (j+1) + '</div><div>ID : ' + userId + '</div></th></tr>';
					if(!(typeof(dataJSON.data[j].from) === 'undefined')){
						fromName = dataJSON.data[j].from.name;
						fromCategory = dataJSON.data[j].from.category;
						fromId = dataJSON.data[j].from.id;
						displayTable += '<tr><td rowspan = "4"><b>From</b></td></tr><tr><td><b>Name : </b>' + fromName + '</td></tr><tr><td><b>Category : </b>' + fromCategory + '</td></tr><tr><td><b>Id : </b>' + fromId + '</td></tr>';
					}
					message = dataJSON.data[j].message;
					picture = dataJSON.data[j].picture;	
					link = dataJSON.data[j].link;
					name = dataJSON.data[j].name;
					caption = dataJSON.data[j].caption;
					description = dataJSON.data[j].description;
					icon = dataJSON.data[j].icon;
					actions = dataJSON.data[j].actions;
					//noOfActions = dataJSON.data[0].actions.length;
					actionItem = '';
					if(actions.length == null) {
						actionItem += "No Likes or Comments";
					} else {
						actionItem = '<ul>	';
						for(var i = 0; i < actions.length; i++) {
							actionItem += "<li><a target='_blank' href='" + actions[i].link +"'>" + actions[i].name +"</a></li>";
						}
					}
					actionItem += "</ul>";
					
					type = dataJSON.data[j].type;
					statusType = dataJSON.data[j].status_type;
					if(!(typeof(dataJSON.data[j].application) === 'undefined')){
						appName = dataJSON.data[j].application.name;
						appId = dataJSON.data[j].application.id;
					} else {
						appName = "No name for application.";
						appId = "No ID for application";
					}
					createdTime = dataJSON.data[j].created_time;
					updatedTime = dataJSON.data[j].updated_time;
					likesItem = "";
					if(typeof(dataJSON.data[j].likes) === 'undefined'){
						likesCount = '0';
					} else {
						likesCount = dataJSON.data[j].likes.count;
					}
					
					if(likesCount != '0'){
						likesData = dataJSON.data[j].likes.data;
						for(var i = 0; i < likesData.length; i++){
							likesItem += "Name : " + likesData[i].name + " Category : " + likesData[i].category + " ID : " + likesData[i].id + "\n";
						}
					} else {
						likesItem = "No likes.";
					}
				
					commentsItem = "";
					if(typeof(dataJSON.data[j].comments) === 'undefined'){
						commentsCount = '0';
					} else {
						commentsCount = dataJSON.data[j].comments.count;
					}
					if(commentsCount != '0'){
						commentsData = dataJSON.data[j].comments.data;
						for(var i = 0; i < commentsData.length; i++){
							commentsItem += "ID : " + commentsData[i].id + " From : (Name : " + commentsData[i].from.name + " ID : " + commentsData[i].from.id + ") Message : " + commentsData[i].message + " Created-Time : " + commentsData[i].created_time + "\n";
						}
					} else {
						commentsItem = "No Comments.";
					}
					displayTable += '<tr><td width = "25%"><b>Message : </b></td><td align = "left" width = "75%">' + message + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>Link : </b></td><td width = "75%" align = "left"><a href = "' + link + '">' + link + '</a></td></tr>';
					displayTable += '<tr><td width = "25%"><b>Name : </b></td><td width = "75%" align = "left">' + name + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>Caption : </b></td><td width = "75%" align = "left">' + caption + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>Description : </b></td><td width = "75%" align = "left">' + description + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>Picture : </b></td><td width = "75%" align = "left"><img src = "' + picture + '" alt = "Picture not found" height = "100px" width = "100px"></td></tr>';
					displayTable += '<tr><td width = "25%"><b>Icon : </b></td><td width = "75%" align = "left"><img src = "' + icon + '" alt = "Picture not found" height = "25px" width = "25px"></td></tr>';
					displayTable += '<tr><td width = "25%"><b>Actions : </b></td><td width = "75%" align = "left">' + actionItem + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>Type : </b></td><td width = "75%" align = "left">' + type + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>Status Type : </b></td><td width = "75%" align = "left">' + statusType + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>App Name : </b></td><td width = "75%" align = "left">' + appName + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>App Id : </b></td><td width = "75%" align = "left">' + appId + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>Created Time : </b></td><td width = "75%" align = "left">' + createdTime + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>Updated Time : </b></td><td width = "75%" align = "left">' + updatedTime + '</td></tr>';
					displayTable += '<tr><td width = "25%"><b>Likes Details : </b></td><td width = "75%" align = "left">' + likesItem + '</td></tr>';
					//displayTable += '<tr><td width = "25%"><b>Likes Details : </b></td>' + displayLikes + '</tr>';
					displayTable += '<tr><td width = "25%"><b>Comments Details : </b></td><td width = "75%" align = "left">' + commentsItem + '</td></tr>';
					
					displayTable += '<tr></tr>';
				}
				displayTable += '</table>';
				YUI().use('tabview','autocomplete', 'autocomplete-highlighters','node','event','autocomplete-filters', function (Y) {
				// TabView is available and ready for use. Add implementation
				// code here. '<table width="100%"><tr><td>ID : ' + userId + '</td><td>From :- Name : ' + fromName + ' Category : ' + fromCategory + ' ID : ' + fromId + '</td></tr><tr><td>From  : </td><td></td></tr></table>'
				var tabview = new Y.TabView({
					children: [{
						label: 'Posts',
						content: displayTable
					}, 
					{
						label: 'Likes',
						content: ''
					}]
				});
		    
			
				tabview.render('#dataTable');
		
				Y.one('body').addClass('yui3-skin-sam');
			});
			}
		}
		
		
	</script>
	<body class="yui3-skin-sam">
		<form name = "exercise" method="POST" action="#"  onsubmit="return validate();">
			<input type="button" class="" id="search" name="search" value="Search" onClick="validate()">
		</form>
		<div id = "dataTable" style = "visibility : visible">
		</div>
	</body>
</html>